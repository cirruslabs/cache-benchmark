# name: Benchmark

# on:
#   push:

# permissions:
#   contents: read

# concurrency:
#   group: benchmark-${{ github.head_ref }}
#   cancel-in-progress: true

# jobs:
#   cache-uploads:
#     name: Clean build with cache uploads
#     runs-on: namespace-profile-default-macos
#     timeout-minutes: 20
#     steps:
#       - uses: actions/checkout@v4
#       - uses: jdx/mise-action@v2
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

#       - name: Authenticate Tuist
#         working-directory: xcode_project_with_cache
#         run: TUIST_URL="https://staging.tuist.dev" tuist auth login --email tuistrocks@tuist.dev --password ${{ secrets.TUIST_TEST_ACCOUNT_PASSWORD }}

#       - name: Setup Tuist Cache
#         working-directory: xcode_project_with_cache
#         run: tuist setup cache

#       - name: Create logs directory
#         run: mkdir logs

#       - name: Benchmark clean build with cache uploads
#         working-directory: xcode_project_with_cache
#         run: |
#           hyperfine --warmup 1 --runs 10 \
#             --prepare 'rm -rf ~/Library/Developer/Xcode/DerivedData && ../tuist-setup-temp-project && tuist setup cache' \
#             --conclude '../tuist-cleanup-temp-project' \
#             'HANDLE="$(cat .tuist-temp-org)_$(cat .tuist-temp-project)" && xcodebuild -project App.xcodeproj -scheme App -destination "platform=iOS Simulator,name=iPhone 17" build COMPILATION_CACHE_REMOTE_SERVICE_PATH="$HOME/.local/state/tuist/$HANDLE.sock" >> ../logs/benchmark-cache-uploads.log 2>&1'

#       - name: Upload benchmark logs
#         uses: actions/upload-artifact@v4
#         with:
#           name: benchmark-logs-cache-uploads
#           path: logs/*.log

#   pre-warmed:
#     name: Clean build with pre-warmed cache
#     runs-on: namespace-profile-default-macos
#     timeout-minutes: 20
#     steps:
#       - uses: actions/checkout@v4
#       - uses: jdx/mise-action@v2
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

#       - name: Authenticate Tuist
#         working-directory: xcode_project_with_cache
#         run: TUIST_URL="https://staging.tuist.dev" tuist auth login --email tuistrocks@tuist.dev --password ${{ secrets.TUIST_TEST_ACCOUNT_PASSWORD }}

#       - name: Setup Tuist Cache
#         working-directory: xcode_project_with_cache
#         run: tuist setup cache

#       - name: Create logs directory
#         run: mkdir logs

#       - name: Benchmark clean build with pre-warmed cache
#         working-directory: xcode_project_with_cache
#         run: |
#           hyperfine --warmup 1 --runs 10 \
#             --setup 'xcodebuild -project App.xcodeproj -scheme App -destination "platform=iOS Simulator,name=iPhone 17" build >> ../logs/benchmark-pre-warmed-setup.log 2>&1' \
#             --prepare 'rm -rf ~/Library/Developer/Xcode/DerivedData' \
#             'xcodebuild -project App.xcodeproj -scheme App -destination "platform=iOS Simulator,name=iPhone 17" build >> ../logs/benchmark-pre-warmed-cache.log 2>&1'

#       - name: Upload benchmark logs
#         uses: actions/upload-artifact@v4
#         with:
#           name: benchmark-logs-pre-warmed
#           path: logs/*.log

#   no-caching:
#     name: Clean build without caching
#     runs-on: namespace-profile-default-macos
#     timeout-minutes: 20
#     steps:
#       - uses: actions/checkout@v4
#       - uses: jdx/mise-action@v2
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

#       - name: Create logs directory
#         run: mkdir logs

#       - name: Benchmark clean build without caching
#         working-directory: xcode_project_with_cache
#         run: |
#           hyperfine --warmup 1 --runs 10 \
#             --prepare 'rm -rf ~/Library/Developer/Xcode/DerivedData' \
#             'xcodebuild -project App.xcodeproj -scheme App -destination "platform=iOS Simulator,name=iPhone 17" build COMPILATION_CACHE_ENABLE_CACHING=NO >> ../logs/benchmark-no-caching.log 2>&1'

#       - name: Upload benchmark logs
#         uses: actions/upload-artifact@v4
#         with:
#           name: benchmark-logs-no-caching
#           path: logs/*.log

#   local-caching:
#     name: Clean build with local caching
#     runs-on: namespace-profile-default-macos
#     timeout-minutes: 20
#     steps:
#       - uses: actions/checkout@v4
#       - uses: jdx/mise-action@v2
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

#       - name: Create logs directory
#         run: mkdir logs

#       - name: Benchmark clean build with local caching
#         working-directory: xcode_project_with_cache
#         run: |
#           hyperfine --warmup 1 --runs 10 \
#             --setup 'rm -rf ~/Library/Developer/Xcode/DerivedData' \
#             --prepare 'xcodebuild -project App.xcodeproj -scheme App -destination "platform=iOS Simulator,name=iPhone 17" clean >> ../logs/benchmark-local-clean.log 2>&1' \
#             'xcodebuild -project App.xcodeproj -scheme App -destination "platform=iOS Simulator,name=iPhone 17" build COMPILATION_CACHE_ENABLE_PLUGIN=NO >> ../logs/benchmark-local-caching.log 2>&1'

#       - name: Upload benchmark logs
#         uses: actions/upload-artifact@v4
#         with:
#           name: benchmark-logs-local-caching
#           path: logs/*.log
